@model CourseWork.ViewModels.CommentViewModel
@{
    ViewData["Title"] = $"{ViewBag.CollectionElement.Name}";
}
<div id="collection" class="container mt-5">
    <div class="row shadow pt-1 pb-1 mb-2 bg-white rounded">
        <div class="col-lg-12 mt-2 justify-content-between custom-control-inline">
            <h1 class="h3">
                @ViewBag.CollectionElement.Name
            </h1>
            <div class="d-flex justify-content-end">
                @if (User.Identity.IsAuthenticated && (User.Claims.ElementAt(0).Value == ViewBag.CollectionElement.Collection.User.Id.ToString() || User.IsInRole("Admin")))
                {
                    <a class="btn btn-primary" asp-controller="Collection" asp-action="EditCollectionElement" asp-route-id="@ViewBag.CollectionElement.Id">Редактировать</a>
                    <a class="btn btn-danger ml-3" asp-controller="Collection" asp-action="DeleteCollectionElement" asp-route-elementId="@ViewBag.CollectionElement.Id">Удалить</a>
                }
            </div>
        </div>
        @*        <div class="col-lg-12 pt-2 pb-2 d-flex justify-content-center">
            <a href="@ViewBag.CollectionElement.Image" data-toggle="lightbox" data-title="@ViewBag.CollectionElement.Title">
            <img src="@ViewBag.CollectionElement.Image" class="card-img-top shadow-sm bg-white rounded image-popup-no-margins" alt="..." style="height: 350px; width: auto;">
            </a>
            </div>*@
        <div class="col-lg-12">
            <span>Теги: </span>
            @foreach (var tag in ViewBag.CollectionElement.Tags)
            {
                <span class="badge badge-secondary">@tag.Name</span>
            }
        </div>
        <div class="col-lg-12">
            Коллекция:
            <a asp-controller="Collection" asp-action="Collection" asp-route-id="@ViewBag.CollectionElement.Collection.Id">@ViewBag.CollectionElement.Collection.Name</a>
        </div>
        <div class="col-lg-12 border-top mt-3 pt-3 pb-1">
            @for (int i = 0; i < ViewBag.CollectionElement.AdditionalFields.Count; i++)
            {
                if (!string.IsNullOrWhiteSpace(ViewBag.CollectionElement.AdditionalFields[i].Value))
                {
                    <h4 class="h4">@ViewBag.CollectionElement.AdditionalFields[i].Name.Name</h4>
                    <span>@ViewBag.CollectionElement.AdditionalFields[i].Value</span>
                }
            }
        </div>
        <div class="col-lg-12 pt-2 pb-2 mb-2 bg-white rounded justify-content-center">
            @if (User.Identity.IsAuthenticated)
            {
                <h5 class="h5 mb-2 mt-2">Ваш комментарий</h5>
                <form class="form-group" method="post" asp-controller="Collection" asp-action="CreateComment">
                    <div asp-validation-summary="ModelOnly"></div>
                    <input type="hidden" asp-for="UserId" value="@User.Claims.ElementAt(0).Value" />
                    <input type="hidden" asp-for="CollectionElementId" value="@ViewBag.CollectionElement.Id" />
                    <div class="form-group">
                        <textarea class="form-control shadow-sm bg-white rounded" asp-for="Text" placeholder="Введите текст"></textarea>
                        <span asp-validation-for="Text" class="text-danger"></span>
                    </div>
                    <div class="text-right">
                        <button type="submit" class="btn btn-success shadow-sm rounded">Отправить</button>
                    </div>
                </form>
            }
        </div>
        <div class="col-lg-12"><h5 class="h5">Все комментарии</h5></div>

        @foreach (var comment in ViewBag.CollectionElement.Comments)
        {
            <div class="col-lg-11 pt-2 pb-2 mb-2 bg-white shadow ml-3">
                <a asp-controller="Profile" asp-action="Profile" asp-route-id="@comment.User.Id" class="h4 mb-2 mt-2">
                    @comment.User.UserName
                </a>
                <p>@comment.Text</p>
            </div>
        }
    </div>
</div>